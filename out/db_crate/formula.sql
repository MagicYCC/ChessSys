-- 起步价 sp
-- 起步时长（分钟）st
-- 后续跳费时长（分钟）jt
-- 跳费价格1 jp1
-- 跳费价格2 jp2
-- 跳费价格2当日起始时间（分钟） sjt > 0(当日0点)
-- 跳费价格2当日结束时间（分钟） ejt <= 1440(24点)

-- 一天总跳费次数
1440/jt -- 1440/jt必须无小数位

-- 时间段2总跳费次数
(ejt-sjt)/jt -- (ejt-sjt)/jt (1440-(ejt-sjt))/jt必须无小数位

-- 时间段1总时长
1440-ejt+sjt

-- 时间段2总时长
ejt-sjt

-- 最后一天起始时间
DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE)

-- 最后一天总跳费次数
FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), closing_time)/jt) + 1

-- 最后一天起始时间分钟数
HOUR(DATE_ADD(entry_time, INTERVAL st MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st MINUTE))

-- 最后一天结束时间分钟数
HOUR(closing_time)*60 + MINUTE(closing_time)

-- 最后entry_time时间段2起始时间
DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE) AS DATE), INTERVAL sjt MINUTE)
DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440)+1 DAY), INTERVAL st MINUTE) AS DATE), INTERVAL sjt MINUTE) -- 第二天

-- 最后entry_time时间段2结束时间
DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE) AS DATE), INTERVAL ejt MINUTE)
DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440)+1 DAY), INTERVAL st MINUTE) AS DATE), INTERVAL ejt MINUTE) -- 第二天

-- 最后一天时间段2起始时间
DATE_ADD(CAST(closing_time AS DATE), INTERVAL sjt MINUTE)

-- 最后一天时间段2结束时间
DATE_ADD(CAST(closing_time AS DATE), INTERVAL ejt MINUTE)


-- 最后起始时间在时间段2内情况
-- 最后一天时间段2总跳费次数
(FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), LEAST(DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE) AS DATE), INTERVAL ejt MINUTE), closing_time))/jt) + 1 + IF(DATE_SUB(closing_time, INTERVAL 1 DAY) < DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE) AS DATE), INTERVAL ejt MINUTE), 0, FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), closing_time)/jt) - FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440)+1 DAY), INTERVAL st MINUTE) AS DATE), INTERVAL sjt MINUTE))/jt)))

-- 最后起始时间在时间段2以外情况
-- 下一个时间段2起始时间
DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440)+IF(HOUR(DATE_ADD(entry_time, INTERVAL st MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st MINUTE))<sjt, 0, 1) DAY), INTERVAL st MINUTE) AS DATE), INTERVAL sjt MINUTE)
-- 下一个时间段2结束时间
DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440)+IF(HOUR(DATE_ADD(entry_time, INTERVAL st MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st MINUTE))<sjt, 0, 1) DAY), INTERVAL st MINUTE) AS DATE), INTERVAL ejt MINUTE)
-- 最后一天时间段1总跳费次数
(FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), LEAST(DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440)+IF(HOUR(DATE_ADD(entry_time, INTERVAL st MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st MINUTE))<sjt, 0, 1) DAY), INTERVAL st MINUTE) AS DATE), INTERVAL sjt MINUTE), closing_time))/jt) + 1 + IF(closing_time < DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440)+IF(HOUR(DATE_ADD(entry_time, INTERVAL st MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st MINUTE))<sjt, 0, 1) DAY), INTERVAL st MINUTE) AS DATE), INTERVAL ejt MINUTE), 0, FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), closing_time)/jt) - FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440)+IF(HOUR(DATE_ADD(entry_time, INTERVAL st MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st MINUTE))<sjt, 0, 1) DAY), INTERVAL st MINUTE) AS DATE), INTERVAL ejt MINUTE))/jt)))

-- 最后一天计费总金额
(FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), closing_time)/jt) + 1)*(jp1)+IF(HOUR(DATE_ADD(entry_time, INTERVAL st MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st MINUTE))>=sjt AND HOUR(DATE_ADD(entry_time, INTERVAL st MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st MINUTE))<ejt, (FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), LEAST(DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE) AS DATE), INTERVAL ejt MINUTE), closing_time))/jt) + 1 + IF(DATE_SUB(closing_time, INTERVAL 1 DAY) < DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE) AS DATE), INTERVAL ejt MINUTE), 0, FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), closing_time)/jt) - FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440)+1 DAY), INTERVAL st MINUTE) AS DATE), INTERVAL sjt MINUTE))/jt))), FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), closing_time)/jt) + 1 - (FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), LEAST(DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440)+IF(HOUR(DATE_ADD(entry_time, INTERVAL st MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st MINUTE))<sjt, 0, 1) DAY), INTERVAL st MINUTE) AS DATE), INTERVAL sjt MINUTE), closing_time))/jt) + 1 + IF(closing_time < DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440)+IF(HOUR(DATE_ADD(entry_time, INTERVAL st MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st MINUTE))<sjt, 0, 1) DAY), INTERVAL st MINUTE) AS DATE), INTERVAL ejt MINUTE), 0, FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), closing_time)/jt) - FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440)+IF(HOUR(DATE_ADD(entry_time, INTERVAL st MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st MINUTE))<sjt, 0, 1) DAY), INTERVAL st MINUTE) AS DATE), INTERVAL ejt MINUTE))/jt))))*(jp2-jp1)

-- 增量总天数

-- 全部总金额
sp + IF(time < st, 0, FLOOR((time - st)/1440)*(1440/jt*jp1+(ejt-sjt)/jt*(jp2-jp1)) + (FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), closing_time)/jt) + 1)*(jp1)+IF(HOUR(DATE_ADD(entry_time, INTERVAL st MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st MINUTE))>=sjt AND HOUR(DATE_ADD(entry_time, INTERVAL st MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st MINUTE))<ejt, (FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), LEAST(DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE) AS DATE), INTERVAL ejt MINUTE), closing_time))/jt) + 1 + IF(DATE_SUB(closing_time, INTERVAL 1 DAY) < DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE) AS DATE), INTERVAL ejt MINUTE), 0, FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), closing_time)/jt) - FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440)+1 DAY), INTERVAL st MINUTE) AS DATE), INTERVAL sjt MINUTE))/jt))), FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), closing_time)/jt) + 1 - (FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), LEAST(DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440)+IF(HOUR(DATE_ADD(entry_time, INTERVAL st MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st MINUTE))<sjt, 0, 1) DAY), INTERVAL st MINUTE) AS DATE), INTERVAL sjt MINUTE), closing_time))/jt) + 1 + IF(closing_time < DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440)+IF(HOUR(DATE_ADD(entry_time, INTERVAL st MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st MINUTE))<sjt, 0, 1) DAY), INTERVAL st MINUTE) AS DATE), INTERVAL ejt MINUTE), 0, FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), closing_time)/jt) - FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440) DAY), INTERVAL st MINUTE), DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st)/1440)+IF(HOUR(DATE_ADD(entry_time, INTERVAL st MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st MINUTE))<sjt, 0, 1) DAY), INTERVAL st MINUTE) AS DATE), INTERVAL ejt MINUTE))/jt))))*(jp2-jp1))


-- 起步价1 sp1
-- 起步价2 sp2
-- 起步时长1（分钟）st1
-- 起步时长2（分钟）st2
-- 后续跳费时长（分钟）jt
-- 跳费价格1 jp1
-- 跳费价格2 jp2
-- 跳费价格2当日起始时间（分钟） sjt > 0(当日0点)
-- 跳费价格2当日结束时间（分钟） ejt <= 1440(24点)

-- 起始时间分钟数
HOUR(entry_time)*60 + MINUTE(entry_time )

-- 全部总金额
IF(HOUR(entry_time)*60 + MINUTE(entry_time) >= sjt AND HOUR(entry_time)*60 + MINUTE(entry_time) < ejt, sp2 + IF(time < st2, 0, FLOOR((time - st2)/1440)*(1440/jt*jp1+(ejt-sjt)/jt*(jp2-jp1)) + (FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st2)/1440) DAY), INTERVAL st2 MINUTE), closing_time)/jt) + 1)*(jp1)+IF(HOUR(DATE_ADD(entry_time, INTERVAL st2 MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st2 MINUTE))>=sjt AND HOUR(DATE_ADD(entry_time, INTERVAL st2 MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st2 MINUTE))<ejt, (FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st2)/1440) DAY), INTERVAL st2 MINUTE), LEAST(DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st2)/1440) DAY), INTERVAL st2 MINUTE) AS DATE), INTERVAL ejt MINUTE), closing_time))/jt) + 1 + IF(DATE_SUB(closing_time, INTERVAL 1 DAY) < DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st2)/1440) DAY), INTERVAL st2 MINUTE) AS DATE), INTERVAL ejt MINUTE), 0, FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st2)/1440) DAY), INTERVAL st2 MINUTE), closing_time)/jt) - FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st2)/1440) DAY), INTERVAL st2 MINUTE), DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st2)/1440)+1 DAY), INTERVAL st2 MINUTE) AS DATE), INTERVAL sjt MINUTE))/jt))), FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st2)/1440) DAY), INTERVAL st2 MINUTE), closing_time)/jt) + 1 - (FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st2)/1440) DAY), INTERVAL st2 MINUTE), LEAST(DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st2)/1440)+IF(HOUR(DATE_ADD(entry_time, INTERVAL st2 MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st2 MINUTE))<sjt, 0, 1) DAY), INTERVAL st2 MINUTE) AS DATE), INTERVAL sjt MINUTE), closing_time))/jt) + 1 + IF(closing_time < DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st2)/1440)+IF(HOUR(DATE_ADD(entry_time, INTERVAL st2 MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st2 MINUTE))<sjt, 0, 1) DAY), INTERVAL st2 MINUTE) AS DATE), INTERVAL ejt MINUTE), 0, FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st2)/1440) DAY), INTERVAL st2 MINUTE), closing_time)/jt) - FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st2)/1440) DAY), INTERVAL st2 MINUTE), DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st2)/1440)+IF(HOUR(DATE_ADD(entry_time, INTERVAL st2 MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st2 MINUTE))<sjt, 0, 1) DAY), INTERVAL st2 MINUTE) AS DATE), INTERVAL ejt MINUTE))/jt))))*(jp2-jp1)), sp1 + IF(time < st1, 0, FLOOR((time - st1)/1440)*(1440/jt*jp1+(ejt-sjt)/jt*(jp2-jp1)) + (FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st1)/1440) DAY), INTERVAL st1 MINUTE), closing_time)/jt) + 1)*(jp1)+IF(HOUR(DATE_ADD(entry_time, INTERVAL st1 MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st1 MINUTE))>=sjt AND HOUR(DATE_ADD(entry_time, INTERVAL st1 MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st1 MINUTE))<ejt, (FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st1)/1440) DAY), INTERVAL st1 MINUTE), LEAST(DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st1)/1440) DAY), INTERVAL st1 MINUTE) AS DATE), INTERVAL ejt MINUTE), closing_time))/jt) + 1 + IF(DATE_SUB(closing_time, INTERVAL 1 DAY) < DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st1)/1440) DAY), INTERVAL st1 MINUTE) AS DATE), INTERVAL ejt MINUTE), 0, FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st1)/1440) DAY), INTERVAL st1 MINUTE), closing_time)/jt) - FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st1)/1440) DAY), INTERVAL st1 MINUTE), DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st1)/1440)+1 DAY), INTERVAL st1 MINUTE) AS DATE), INTERVAL sjt MINUTE))/jt))), FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st1)/1440) DAY), INTERVAL st1 MINUTE), closing_time)/jt) + 1 - (FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st1)/1440) DAY), INTERVAL st1 MINUTE), LEAST(DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st1)/1440)+IF(HOUR(DATE_ADD(entry_time, INTERVAL st1 MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st1 MINUTE))<sjt, 0, 1) DAY), INTERVAL st1 MINUTE) AS DATE), INTERVAL sjt MINUTE), closing_time))/jt) + 1 + IF(closing_time < DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st1)/1440)+IF(HOUR(DATE_ADD(entry_time, INTERVAL st1 MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st1 MINUTE))<sjt, 0, 1) DAY), INTERVAL st1 MINUTE) AS DATE), INTERVAL ejt MINUTE), 0, FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st1)/1440) DAY), INTERVAL st1 MINUTE), closing_time)/jt) - FLOOR(TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st1)/1440) DAY), INTERVAL st1 MINUTE), DATE_ADD(CAST(DATE_ADD(DATE_ADD(entry_time, INTERVAL FLOOR((time - st1)/1440)+IF(HOUR(DATE_ADD(entry_time, INTERVAL st1 MINUTE))*60 + MINUTE(DATE_ADD(entry_time, INTERVAL st1 MINUTE))<sjt, 0, 1) DAY), INTERVAL st1 MINUTE) AS DATE), INTERVAL ejt MINUTE))/jt))))*(jp2-jp1)))
